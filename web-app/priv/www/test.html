<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="js/jquery-1.3.2.js"></script>
  <script src="js/erlmmo-api.js"></script>
  <script src="js/testrunner.js"></script>
  <link rel="stylesheet" href="js/testsuite.css" type="text/css" media="screen" />
  
  <script>
  $(document).ready(function(){
        module("Test");
        test("API Available", function() {
            expect(1);
            stop(6000);
            
            test_test(function (result) {
                equals(result, "OK", "Result check");
                start();
            });
        });
        
        module("Authentication");
        
        test("login + logoff", function() {
            expect(4);
            stop(6000);
            
            // Login :)
            auth_login("Test1", "a", function(sessionkey, timeout) {
              ok(sessionkey != null, "Sessionkey test");
              ok(timeout > 0, "Timeout value is positive");
              
              // Now logout again
              auth_logoff(sessionkey, function(result) {
                equals(result, "OK", "Check for successfull logout.");
                
                auth_logoff(sessionkey, function(result) {
                    same(result, {"code": 001, "message":"Invalid sessionkey."}, "Invalid session error");
                    
                    start();    
                });
                
              });
            });
        });
        
        test("Login + Relogin", function() {
           expect(3);
           
           stop(6000);
           
           auth_login("Test2", "password", function(sessionkey, timeout) {
                ok(sessionkey != null, "Received sessionkey");
                ok(timeout > 0, "Received timeout");
                
                auth_login("Test2", "password", function(sessionkey2, timeout2) {
                   equals(sessionkey2, sessionkey, "Checking for equals sessionkey.");
                   
                   auth_logoff(sessionkey, function() {
                        start();
                   });
                });
           });
        });
        
        module("Chat");
        test("sending and receiving messages", function() {
            expect(4);
            stop(6000);
            
            auth_login("Test2", "mypassword$", function(sessionkey, timeout) {
                ok(sessionkey != null, "Successfull login");
                
                event_get(sessionkey, function(event) {
                    ok(event != null, "Valid event received.");
                    
                    chat_send(sessionkey, "Hi!", function(result) {
                       equals(result, "OK");
                       
                        event_get(sessionkey, function(event) {
                           same(event, ["chat_message", "Test2", "Hi!"], "Receive our own chat message");
                           
                           auth_logoff(sessionkey);
                           
                           start();
                        });
                    });
                });
                
            });
        });
        
        
  });
  </script>
  
</head>
<body>
  

 <h1>Erlmmo API Tests</h1>
 <h2 id="banner"></h2>
 <h2 id="userAgent"></h2>

 <ol id="tests"></ol>

 <div id="main"></div>
 
</body>
</html>
